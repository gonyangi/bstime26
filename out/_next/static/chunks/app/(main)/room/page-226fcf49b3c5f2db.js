(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[483],{1696:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>T});var r=a(5155),s=a(2115),l=a(63),o=a(3998),n=a(6948),i=a(6549),d=a(2544),c=a(6942),m=a(5653),u=a(1834),x=a(5142),f=a(7129),p=a(4269),b=a(489);let g=(0,a(3101).F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),h=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(b.b,{ref:t,className:(0,p.cn)(g(),a),...s})});h.displayName=b.b.displayName;let j=d.Op,N=s.createContext({}),y=e=>{let{...t}=e;return(0,r.jsx)(N.Provider,{value:{name:t.name},children:(0,r.jsx)(d.xI,{...t})})},v=()=>{let e=s.useContext(N),t=s.useContext(w),{getFieldState:a,formState:r}=(0,d.xW)(),l=a(e.name,r);if(!e)throw Error("useFormField should be used within <FormField>");let{id:o}=t;return{id:o,name:e.name,formItemId:"".concat(o,"-form-item"),formDescriptionId:"".concat(o,"-form-item-description"),formMessageId:"".concat(o,"-form-item-message"),...l}},w=s.createContext({}),C=s.forwardRef((e,t)=>{let{className:a,...l}=e,o=s.useId();return(0,r.jsx)(w.Provider,{value:{id:o},children:(0,r.jsx)("div",{ref:t,className:(0,p.cn)("space-y-2",a),...l})})});C.displayName="FormItem";let k=s.forwardRef((e,t)=>{let{className:a,...s}=e,{error:l,formItemId:o}=v();return(0,r.jsx)(h,{ref:t,className:(0,p.cn)(l&&"text-destructive",a),htmlFor:o,...s})});k.displayName="FormLabel";let D=s.forwardRef((e,t)=>{let{...a}=e,{error:s,formItemId:l,formDescriptionId:o,formMessageId:n}=v();return(0,r.jsx)(f.DX,{ref:t,id:l,"aria-describedby":s?"".concat(o," ").concat(n):"".concat(o),"aria-invalid":!!s,...a})});D.displayName="FormControl",s.forwardRef((e,t)=>{let{className:a,...s}=e,{formDescriptionId:l}=v();return(0,r.jsx)("p",{ref:t,id:l,className:(0,p.cn)("text-sm text-muted-foreground",a),...s})}).displayName="FormDescription";let R=s.forwardRef((e,t)=>{var a;let{className:s,children:l,...o}=e,{error:n,formMessageId:i}=v(),d=n?String(null!=(a=null==n?void 0:n.message)?a:""):l;return d?(0,r.jsx)("p",{ref:t,id:i,className:(0,p.cn)("text-sm font-medium text-destructive",s),...o,children:d}):null});R.displayName="FormMessage";var F=a(5894),E=a(9516);function M(e){let t=new Date(e),a=t.getDay(),r=t.getDate()-a+(0===a?-6:1);return new Date(t.setDate(r))}function S(e){return e.toISOString().split("T")[0]}var P=a(6344),z=a(9708);let I=m.Ik({fixedBooking:m.Yj().optional(),extraClass:m.Yj().optional()});function O(e){let{isOpen:t,onClose:a,room:l,day:n,period:m,date:f}=e,p=(0,P.jt)(),b="artifacts/".concat(P.R0,"/public/data"),{data:g}=(0,P.Ge)((0,s.useMemo)(()=>p?(0,z.P)((0,z.rJ)(p,b,"fixedData")):null,[p])),h=(0,s.useMemo)(()=>g?Object.fromEntries(g.map(e=>[e.id,e.val])):{},[g]),{data:N}=(0,P.Ge)((0,s.useMemo)(()=>p?(0,z.P)((0,z.rJ)(p,b,"extraRes")):null,[p])),{toast:v}=(0,F.dj)(),[w,M]=(0,s.useTransition)(),O=l&&n&&m?"".concat(l,"-").concat(n,"-").concat(m):"",B=h[O]||"",A=(0,d.mN)({resolver:(0,c.u)(I),defaultValues:{fixedBooking:"",extraClass:""}});if((0,s.useEffect)(()=>{t&&A.reset({fixedBooking:B,extraClass:""})},[t,B,A,f]),!t||!l||!n||!m)return null;let G=f?f.getDay()-1:-1,J=G>=0&&G<5?i.Rl[i.qn[G]]:"",U=f?"".concat(f.getMonth()+1,"/").concat(f.getDate(),"(").concat(J,")"):"";return(0,r.jsx)(u.lG,{open:t,onOpenChange:a,children:(0,r.jsxs)(u.Cf,{className:"sm:max-w-lg bg-card rounded-2xl p-8 shadow-2xl border-2 border-blue-100",children:[(0,r.jsxs)(u.c7,{children:[(0,r.jsx)(u.L3,{className:"text-2xl font-bold mb-4 border-b pb-2",children:"관리 및 예약"}),(0,r.jsxs)("div",{className:"p-3 bg-blue-50 rounded-xl text-lg text-blue-700 mb-2 font-bold border text-center",children:["\uD83D\uDCCD ",i.pR[l]," / ",U," ",i.kl[m]]})]}),(0,r.jsx)(j,{...A,children:(0,r.jsxs)("form",{onSubmit:A.handleSubmit(e=>{M(async()=>{try{if(e.fixedBooking!==B&&await (0,E.UM)(p,O,e.fixedBooking||""),e.extraClass&&f){let t=f.getUTCDay();if(6===t||0===t)return void v({variant:"destructive",title:"예약 불가",description:"토요일 또는 일요일은 휴일이므로 예약할 수 없습니다."});let a=S(f);if(null==N?void 0:N.some(e=>e.room===i.pR[l]&&e.date===a&&e.period.toString()===m))return void v({variant:"destructive",title:"오류",description:"이미 예약된 시간입니다."});await (0,E.UU)(p,{room:i.pR[l],date:a,period:m,className:e.extraClass})}v({title:"성공",description:"시간표가 저장되었습니다."}),a()}catch(e){v({variant:"destructive",title:"오류",description:"저장에 실패했습니다."}),console.error(e)}})}),className:"space-y-4",children:[(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)(y,{control:A.control,name:"fixedBooking",render:e=>{let{field:t}=e;return(0,r.jsxs)(C,{children:[(0,r.jsx)(k,{className:"block text-sm font-bold text-gray-500 mb-1",children:"기초 등록 (매주 반복)"}),(0,r.jsx)(D,{children:(0,r.jsx)(x.p,{placeholder:"학급명 입력 후 Enter",...t,className:"w-full border-2 p-3 rounded-xl text-xl h-auto"})}),(0,r.jsx)(R,{})]})}}),(0,r.jsx)("div",{className:"border-t pt-4",children:(0,r.jsx)(y,{control:A.control,name:"extraClass",render:e=>{let{field:t}=e;return(0,r.jsxs)(C,{children:[(0,r.jsx)(k,{className:"block text-sm font-bold text-amber-600 mb-2",children:"추가 예약 (선착순)"}),(0,r.jsx)(D,{children:(0,r.jsx)(x.p,{placeholder:"학급명 입력 후 Enter",...t,className:"w-full border-2 p-3 rounded-xl text-xl h-auto"})}),(0,r.jsx)(R,{})]})}})})]}),(0,r.jsxs)(u.Es,{className:"!mt-8 flex-row gap-3",children:[(0,r.jsx)(o.$,{type:"button",variant:"outline",onClick:a,className:"flex-1 bg-gray-100 py-3 rounded-xl font-bold text-lg text-gray-600 hover:bg-gray-200 transition-colors h-auto",children:"취소"}),(0,r.jsx)(o.$,{type:"submit",className:"flex-1 py-3 rounded-xl font-bold text-lg shadow-lg h-auto",disabled:w,children:w?"저장 중...":"저장"})]})]})})]})})}var B=a(243),A=a(1190),G=a(3263),J=a(3630);function U(e){let{currentDate:t,onPrevWeek:a,onNextWeek:s}=e,l=M(t),n="".concat(l.getFullYear(),"년 ").concat(l.getMonth()+1,"월");return(0,r.jsxs)("div",{className:"flex items-center justify-center gap-4 mb-4",children:[(0,r.jsx)(o.$,{variant:"outline",size:"icon",onClick:a,className:"h-10 w-10",children:(0,r.jsx)(A.A,{className:"h-6 w-6"})}),(0,r.jsx)("div",{className:"text-xl font-bold text-center w-48",children:n}),(0,r.jsx)(o.$,{variant:"outline",size:"icon",onClick:s,className:"h-10 w-10",children:(0,r.jsx)(G.A,{className:"h-6 w-6"})})]})}function $(e){let{currentRoom:t,onSelectRoom:a}=e;return(0,r.jsx)("div",{className:"flex flex-wrap gap-2 mb-4 justify-center",children:Object.entries(i.pR).map(e=>{let[s,l]=e;return(0,r.jsx)(o.$,{className:(0,p.cn)("px-4 py-2 rounded-lg border-2 font-bold text-base transition-all",t===s?"border-blue-600 bg-blue-50 text-blue-600 shadow-sm":"bg-white border-gray-200 text-gray-500"),onClick:()=>a(s),children:l},s)})})}function _(e){let{currentRoom:t,currentDate:a}=e,l=(0,P.jt)(),{toast:o}=(0,F.dj)(),d="artifacts/".concat(P.R0,"/public/data"),{data:c,loading:m}=(0,P.Ge)((0,s.useMemo)(()=>l?(0,z.P)((0,z.rJ)(l,d,"fixedData")):null,[l])),u=(0,s.useMemo)(()=>c?Object.fromEntries(c.map(e=>[e.id,e.val])):{},[c]),{data:x,loading:f}=(0,P.Ge)((0,s.useMemo)(()=>l?(0,z.P)((0,z.rJ)(l,d,"extraRes")):null,[l])),[b,g]=(0,s.useState)({open:!1}),h=(0,s.useCallback)(async e=>{if(!l)return void o({title:"DB 연결 오류",variant:"destructive"});try{await (0,E.$y)(l,e),o({title:"삭제 완료"})}catch(e){console.error("삭제 실패:",e),o({title:"삭제 실패",variant:"destructive"})}},[l,o]),j=(0,s.useCallback)(async e=>{if(!l)return void o({title:"DB 연결 오류",variant:"destructive"});try{await (0,E.bm)(l,e),o({title:"삭제 완료"})}catch(e){console.error("삭제 실패:",e),o({title:"삭제 실패",variant:"destructive"})}},[l,o]);if(m||f)return(0,r.jsx)(B.E,{className:"w-full h-[600px] rounded-2xl"});let N=M(a),y=Array.from({length:5}).map((e,t)=>{let a=new Date(N);return a.setDate(N.getDate()+t),a}),v={};return null==x||x.filter(e=>e.room===i.pR[t]).forEach(e=>{v["".concat(e.date,"-").concat(e.period)]=e}),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.Zp,{className:"shadow-lg overflow-hidden border",children:(0,r.jsx)(n.Wu,{className:"p-0",children:(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"w-full text-center border-collapse",children:[(0,r.jsx)("thead",{className:"bg-primary text-primary-foreground text-lg font-bold",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"p-3 w-20 sm:w-24 border-b",children:"교시"}),y.map((e,t)=>(0,r.jsx)("th",{className:"border-b w-1/5",children:"".concat(e.getMonth()+1,"/").concat(e.getDate()).concat(i.Rl[i.qn[t]])},i.qn[t]))]})}),(0,r.jsx)("tbody",{className:"text-xl",children:i.nR.map(e=>(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{className:"p-3 bg-gray-50 font-bold text-gray-400 border text-sm text-center h-20",children:i.kl[e]}),y.map((a,s)=>{let l=i.qn[s],o="".concat(t,"-").concat(l,"-").concat(e),n=u[o],d=S(a),c=v["".concat(d,"-").concat(e)],m=!!c||!!n;return(0,r.jsx)("td",{className:(0,p.cn)("p-2 border h-20 text-xl text-center break-words leading-tight relative group",c?"bg-amber-100 text-amber-800 font-bold":n?"bg-blue-50 text-blue-800 font-bold":"bg-white hover:bg-gray-50 cursor-pointer"),onClick:()=>{m||g({open:!0,day:l,period:e,date:a})},children:c?(0,r.jsxs)(r.Fragment,{children:[c.className,(0,r.jsx)("button",{className:"absolute top-1 right-1 bg-red-500 text-white w-6 h-6 rounded-md flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity z-10",onClick:e=>{e.stopPropagation(),j(c.id)},children:(0,r.jsx)(J.A,{size:16})})]}):(0,r.jsxs)(r.Fragment,{children:[n,n&&(0,r.jsx)("button",{className:"absolute top-1 right-1 bg-red-500 text-white w-6 h-6 rounded-md flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity z-10",onClick:e=>{e.stopPropagation(),h(o)},children:(0,r.jsx)(J.A,{size:16})})]})},l)})]},e))})]})})})}),(0,r.jsx)(O,{isOpen:b.open,onClose:()=>g({...b,open:!1}),room:t,day:b.day,period:b.period,date:b.date})]})}function L(){let e=(0,l.useSearchParams)(),t=(0,l.useRouter)(),[a,o]=(0,s.useState)(e.get("room")||"gangdang"),[n,i]=(0,s.useState)(new Date("2026-03-02T00:00:00"));return(0,r.jsxs)("section",{children:[(0,r.jsx)($,{currentRoom:a,onSelectRoom:e=>{o(e),t.push("/room?room=".concat(e))}}),(0,r.jsx)(U,{currentDate:n,onPrevWeek:()=>{let e=new Date(n);e.setDate(n.getDate()-7),i(e)},onNextWeek:()=>{let e=new Date(n);e.setDate(n.getDate()+7),i(e)}}),(0,r.jsx)(_,{currentRoom:a,currentDate:n})]})}function T(){return(0,r.jsx)(s.Suspense,{fallback:(0,r.jsx)(B.E,{className:"w-full h-[700px]"}),children:(0,r.jsx)(L,{})})}},1834:(e,t,a)=>{"use strict";a.d(t,{Cf:()=>m,Es:()=>x,L3:()=>f,c7:()=>u,lG:()=>i});var r=a(5155),s=a(2115),l=a(7283),o=a(6615),n=a(4269);let i=l.bL;l.l9;let d=l.ZL;l.bm;let c=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(l.hJ,{ref:t,className:(0,n.cn)("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...s})});c.displayName=l.hJ.displayName;let m=s.forwardRef((e,t)=>{let{className:a,children:s,...i}=e;return(0,r.jsxs)(d,{children:[(0,r.jsx)(c,{}),(0,r.jsxs)(l.UC,{ref:t,className:(0,n.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...i,children:[s,(0,r.jsxs)(l.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,r.jsx)(o.A,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});m.displayName=l.UC.displayName;let u=e=>{let{className:t,...a}=e;return(0,r.jsx)("div",{className:(0,n.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...a})};u.displayName="DialogHeader";let x=e=>{let{className:t,...a}=e;return(0,r.jsx)("div",{className:(0,n.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...a})};x.displayName="DialogFooter";let f=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(l.hE,{ref:t,className:(0,n.cn)("text-lg font-semibold leading-none tracking-tight",a),...s})});f.displayName=l.hE.displayName,s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(l.VY,{ref:t,className:(0,n.cn)("text-sm text-muted-foreground",a),...s})}).displayName=l.VY.displayName},1857:(e,t,a)=>{Promise.resolve().then(a.bind(a,1696))},5142:(e,t,a)=>{"use strict";a.d(t,{p:()=>o});var r=a(5155),s=a(2115),l=a(4269);let o=s.forwardRef((e,t)=>{let{className:a,type:s,...o}=e;return(0,r.jsx)("input",{type:s,className:(0,l.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),ref:t,...o})});o.displayName="Input"},6948:(e,t,a)=>{"use strict";a.d(t,{Wu:()=>n,Zp:()=>o});var r=a(5155),s=a(2115),l=a(4269);let o=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,l.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",a),...s})});o.displayName="Card",s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,l.cn)("flex flex-col space-y-1.5 p-6",a),...s})}).displayName="CardHeader",s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,l.cn)("text-2xl font-semibold leading-none tracking-tight",a),...s})}).displayName="CardTitle",s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,l.cn)("text-sm text-muted-foreground",a),...s})}).displayName="CardDescription";let n=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,l.cn)("p-6 pt-0",a),...s})});n.displayName="CardContent",s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,l.cn)("flex items-center p-6 pt-0",a),...s})}).displayName="CardFooter"}},e=>{e.O(0,[992,644,909,514,49,932,73,234,441,255,358],()=>e(e.s=1857)),_N_E=e.O()}]);